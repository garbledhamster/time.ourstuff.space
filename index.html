<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b1020" />
  <title>Ticket Time Tracker</title>

  <!-- FullCalendar (global bundle) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css">
  <!-- App styles -->
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="app">
    <!-- Top bar -->
    <header class="topbar">
      <div class="brand pill" title="Ticket Time Tracker">
        <span aria-hidden>⏱️</span>
        <span>Ticket Time</span>
      </div>

      <button class="btn mobileOnly" id="openDrawerBtn" title="Open ticket drawer">
        <svg class="btn-icon" viewBox="0 0 24 24"><path d="M4 5h16"/><path d="M4 12h16"/><path d="M4 19h16"/></svg>
        Tickets
      </button>

      <div class="spacer"></div>

      <div class="viewGroup">
        <button class="btn btn-icon-only" id="prevBtn" title="Previous">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
        </button>
        <button class="btn" id="todayBtn" title="Today">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
          Today
        </button>
        <button class="btn btn-icon-only" id="nextBtn" title="Next">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
        </button>

        <span class="divider"></span>

        <button class="btn" data-view="timeGridDay">
          <svg class="btn-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
          Day
        </button>
        <button class="btn" data-view="timeGridWeek">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
          Week
        </button>
        <button class="btn" data-view="dayGridMonth">
          <svg class="btn-icon" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M16 2v4"/><path d="M3 10h18"/><path d="M8 2v4"/><path d="M17 14h-6"/><path d="M13 18H7"/><path d="M7 14h.01"/><path d="M17 18h.01"/></svg>
          Month
        </button>
        <button class="btn" data-view="listWeek">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="M3 5h.01"/><path d="M3 12h.01"/><path d="M3 19h.01"/><path d="M8 5h13"/><path d="M8 12h13"/><path d="M8 19h13"/></svg>
          List
        </button>
      </div>
    </header>

    <div class="errorBanner" id="errorBanner" role="alert" aria-live="polite"></div>

    <main class="main">
      <!-- Tickets panel (desktop sidebar, mobile drawer) -->
      <div class="drawerOverlay" id="drawerOverlay"></div>

      <aside class="ticketsPanel" id="ticketsPanel" aria-label="Tickets panel">
        <div class="ticketsHeader">
          <div class="ticketsTitleRow">
            <h2>Tickets</h2>
            <div class="smallMuted">
              <span id="ticketsCount">0</span>
              <button class="btn smallBtn" id="closeDrawerBtn">
                <svg class="btn-icon" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                Close
              </button>
            </div>
          </div>

          <div class="fieldRow">
            <input class="input" id="ticketKeyInput" placeholder="Ticket ID or URL (e.g. 12345 or Zendesk link)" />
          </div>
          <div class="fieldRow">
            <input class="input" id="ticketTitleInput" placeholder="Title" />
          </div>
          <div class="fieldRow">
            <input class="input" id="ticketClientInput" placeholder="Client" />
          </div>

          <div class="fieldRow">
            <button class="btn primary" id="addTicketBtn">
              <svg class="btn-icon" viewBox="0 0 24 24"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
              Add ticket
            </button>
            <button class="btn" id="exportBtn" title="Export time logs to CSV">
              <svg class="btn-icon" viewBox="0 0 24 24"><path d="M12 15V3"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><path d="m7 10 5 5 5-5"/></svg>
              Export
            </button>
            <button class="btn" id="importBtn" title="Import Zendesk tickets from CSV">
              <svg class="btn-icon" viewBox="0 0 24 24"><path d="M12 3v12"/><path d="m17 8-5-5-5 5"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/></svg>
              Import
            </button>
            <input class="hiddenInput" id="importInput" type="file" accept=".csv,text/csv" />
          </div>

          <div class="fieldRow" id="statusFilters" style="gap:12px; flex-wrap:wrap;">
            <span class="smallMuted">Status:</span>
            <label class="smallMuted">
              <input type="checkbox" name="ticketStatusFilter" value="open" checked />
              Open
            </label>
            <label class="smallMuted">
              <input type="checkbox" name="ticketStatusFilter" value="in-progress" checked />
              In-Progress
            </label>
            <label class="smallMuted">
              <input type="checkbox" name="ticketStatusFilter" value="closed" />
              Closed
            </label>
          </div>

          <div class="fieldRow" id="clientFilters" style="gap:12px; flex-wrap:wrap;">
            <span class="smallMuted">Client:</span>
            <select class="input" id="clientFilterSelect" aria-label="Filter by client"></select>
          </div>

          <div class="fieldRow" style="margin-bottom:0;">
            <input class="input" id="ticketSearchInput" placeholder="Search tickets..." />
          </div>

          <div class="themeSection">
            <div class="label">Theme</div>
            <select class="input" id="themePresetSelect"></select>
            <div class="themeCustom" id="themeCustomFields"></div>
          </div>

          <div class="fieldRow" style="gap:8px;">
            <button class="btn" id="expandAllBtn" title="Expand all tickets" aria-label="Expand all tickets to show full details">
              <svg class="btn-icon" viewBox="0 0 24 24"><path d="m7 15 5 5 5-5"/><path d="m7 9 5-5 5 5"/></svg>
              Expand All
            </button>
            <button class="btn" id="collapseAllBtn" title="Collapse all tickets" aria-label="Collapse all inactive tickets to show only ticket keys">
              <svg class="btn-icon" viewBox="0 0 24 24"><path d="m17 11-5-5-5 5"/><path d="m17 18-5-5-5 5"/></svg>
              Collapse All
            </button>
          </div>
        </div>

        <div class="ticketList" id="ticketList"></div>
      </aside>

      <!-- Calendar area -->
      <section class="calendarWrap" aria-label="Calendar area">
        <div class="calendarCard">
          <div id="calendar"></div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal: edit time log -->
  <div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true" aria-label="Edit time log">
    <div class="modal">
      <div class="modalHeader">
        <div>
          <h3 id="modalTitle">Edit time log</h3>
          <div class="sub" id="modalSub">—</div>
        </div>
        <button class="btn btn-icon-only" id="closeModalBtn">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </div>

      <div class="modalBody">
        <div>
          <label for="modalEventTitle" class="label">Title</label>
          <input class="input" id="modalEventTitle" type="text" placeholder="Event title" aria-required="true" />
        </div>

        <div class="grid2">
          <div>
            <div class="label">Start</div>
            <div class="timeInputGroup">
              <input class="input" id="modalStart" type="datetime-local" />
              <button class="btn" id="modalStartNowBtn" type="button" title="Set to current time">
                <svg class="btn-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                Now
              </button>
            </div>
          </div>
          <div>
            <div class="label">End</div>
            <div class="timeInputGroup">
              <input class="input" id="modalEnd" type="datetime-local" />
              <button class="btn" id="modalEndNowBtn" type="button" title="Set to current time">
                <svg class="btn-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                Now
              </button>
            </div>
          </div>
        </div>

        <div>
          <div class="label">Notes</div>
          <textarea class="input" id="modalNotes" placeholder="What did you do? (saved locally)"></textarea>
        </div>

        <div class="smallMuted">
          Tip: Click a block to preview. Click again to edit.
        </div>
      </div>

      <div class="modalFooter">
        <button class="btn danger" id="deleteEventBtn">
          <svg class="btn-icon" viewBox="0 0 24 24"><path d="M10 11v6"/><path d="M14 11v6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
          Delete block
        </button>
        <div class="modalFooterRight">
          <button class="btn" id="cancelModalBtn">
            <svg class="btn-icon" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            Cancel
          </button>
          <button class="btn primary" id="saveModalBtn">
            <svg class="btn-icon" viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg>
            Save
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

  <!-- App (ES Modules) -->
  <script type="module" src="./js/app.js"></script>
</body>
</html>
